<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Vote Consciente</title>
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.12.1/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
        
    </head>
    <body id="page-top">
        
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav">
            <div class="container">
                <a class="navbar-brand js-scroll-trigger" href="#page-top">Vote Consciente</a><button class="navbar-toggler navbar-toggler-right text-uppercase font-weight-bold bg-primary text-white rounded" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">Menu <i class="fas fa-bars"></i></button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#verificador">Candidatos</a></li>
                        <!-- <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#alerta">Denúncia</a></li> -->
                        <li id="opcaoSair" style="display: none" class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#" onclick="deslogar()" >Sair <i class="fa fa-arrow-right" aria-hidden="true"></i></a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Masthead-->
        <header class="masthead bg-primary text-white text-center" id="verificador">
            <div class="container d-flex align-items-center flex-column">
                <!-- Masthead Avatar Image--><img class="masthead-avatar mb-5" src="assets/img/avataaars.svg" alt="" /><!-- Masthead Heading-->
                <h1 class="masthead-heading text-uppercase mb-0">Vote Consciente</h1>
                <!-- Icon Divider-->
                <div class="divider-custom divider-light">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                </div>
                <!-- Masthead Subheading-->
                

                <div class="form-group col-md-4">
                    <p class="masthead-subheading font-weight-light mb-0">Procure pelo estado</p>
                    <select id="estado" class="form-control" onChange="buscarCidadesDoEstado()" >
                        <option selected value="-1">Nenhum</option>
                        <option value="MG">MG</option>
                    </select>
                </div>

                

                <div class="form-group col-md-4" id="divSelectCidades"  style="display: none;">
                    <p class="masthead-subheading font-weight-light mb-0">Procure pelo municipio</p>
                    <select class="form-control" id="selectCidades" >
                        <option selected value="-1">Nenhum</option>
                    </select>
                </div>

                <div class="form-group" id="buscarCandidatos"  style="display: none;">
                    <button onClick="buscarCandidadosPorCidade()" class="btn btn-secondary mt-4 btn-xl"  type="submit">Buscar</button>
                </div>

            </div>
            <iframe width="350" height="430" allow="microphone;" style="
    "src="https://console.dialogflow.com/api-client/demo/embedded/ca9424ab-a815-43a5-8781-b2f97381749d"></iframe>
        </header>
        



        <header class="masthead bg-default text-white text-center" id="candidatos" style="display: none" >
            <div class="container d-flex align-items-center flex-column">
               
                <h1 class="masthead-heading text-uppercase mb-0" style="color:black">PREFEITOS</h1>
                <div class="row" id="divPaiPrefeito" style="color:black;     margin-top: 2em;">
                    
                </div>

                <h1 class="masthead-heading text-uppercase mb-0" style="color:black; margin-top: 1em;">VEREADORES</h1>
                <div class="row" id="divPaiVereador" style="color:black;     margin-top: 2em;">
                    
                </div>

            </div>
        </header>
        
        <div class="modal fade" id="mensagemModal" tabindex="-1" role="dialog" aria-labelledby="mensagemLabel" aria-hidden="true">
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="mensagemLabel">Comentários</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body" style="padding: 1em;">
                  <div class="row" id="comentarios">
                    


                  </div>
                </div>
                <!-- <div class="modal-footer">
                    <button onClick="pegandoURLParInformar('semreclamacao')" class="btn btn-secondary mt-4 btn-xl" id="SemReclamacaoButton" type="submit">Sem Reclamação</button>
                    <button onClick="pegandoURLParInformar('duvidoso')" class="btn btn-secondary mt-4 btn-xl" id="DuvidosoButton" type="submit">Duvidoso</button>
                    <button onClick="pegandoURLParInformar('acusar')" class="btn btn-secondary mt-4 btn-xl" id="AcusarButton"type="submit">Acusar</button>
                </div> -->
              </div>
            </div>
          </div>




          
        <!-- Modal -->
        <div class="modal fade" data-backdrop="static" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">Login</h5>
                </div>
                <form id="form-login"  >
                <!-- <form class="form--cadastro"
                    action="http://localhost:9393/login" method="post" 
                    id="form-cadastro"> -->
                    <div class="modal-body">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Usuario:</span>
                            </div>
                            <input required id="usuario" name="usuario"  class="form-control" placeholder="Username" aria-label="Username" aria-describedby="basic-addon1">
                          </div>
                          <div class="input-group mb-3">
                            <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Senha:</span>
                            </div>
                            <input required id="senha" name="senha" type="password" class="form-control" placeholder="Password" aria-label="Username" aria-describedby="basic-addon1">
                          </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#cadastrarModal">Cadastrar</button>
                        <button type="submit" class="btn btn-primary" >Entrar</button>
                    </div>
                </form>
            </div>
            </div>
        </div>
        <div class="modal fade" id="cadastrarModal" tabindex="-1" role="dialog" aria-labelledby="cadastrarModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="cadastrarModalLabel">Cadastrar</h5>
                </div>
                <!-- <form onsubmit="cadastrar(event)"> -->
                <form id="form-cadastro">
                    <div class="modal-body">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Usuario:</span>
                            </div>
                            <input id="usuarioC" name="usuarioC" required type="text" class="form-control" placeholder="Name" aria-label="Username" aria-describedby="basic-addon1">
                          </div>
                          <div class="input-group mb-3">
                            <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Senha:</span>
                            </div>
                            <input id="senhaC" name="senhaC" required type="password" class="form-control" placeholder="Password" aria-label="Username" aria-describedby="basic-addon1">
                          </div>
                          <div class="input-group mb-3">
                            <div class="input-group-prepend">
                              <span class="input-group-text" id="basic-addon1">Digite novamente a senha:</span>
                            </div>
                            <input id="senha2C" name="senha2C" required type="password" class="form-control" placeholder="Password" aria-label="Username" aria-describedby="basic-addon1">
                          </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary"data-dismiss="modal">Voltar</button>
                        <button type="submit" class="btn btn-primary" >Cadastrar</button>
                    </div>
                </form>
            </div>
            </div>
        </div>
       

        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Resposta</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body">
                <span id = "resposta1"> </span><br></br><br></br>
                <span id = "resposta2"> </span><br></br>
                <span id = "resposta3"> </span><br></br>
                <span id = "resposta4"> </span><br></br>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                </div>
            </div>
            </div>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="alertModal" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Informação</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                </div>
                <div class="modal-body" id="alertMensagem" >
                    
                </div>
            </div>
            </div>
        </div>
       
        <!-- About Section
        <section class="page-section bg-primary text-white mb-0" id="about">
            <div class="container">
                <h2 class="page-section-heading text-center text-uppercase text-white">Sobre</h2>
                <div class="divider-custom divider-light">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                </div>
                <div class="row">
                    <div class="col-lg-4 ml-auto"><p class="lead">Freelancer is a free bootstrap theme created by Start Bootstrap. The download includes the complete source files including HTML, CSS, and JavaScript as well as optional SASS stylesheets for easy customization.</p></div>
                    <div class="col-lg-4 mr-auto"><p class="lead">You can create your own custom avatar for the masthead, change the icon in the dividers, and add your email address to the contact form to make it fully functional!</p></div>
                </div>
                <div class="text-center mt-4">
                    <a class="btn btn-xl btn-outline-light" href="https://startbootstrap.com/themes/freelancer/"><i class="fas fa-download mr-2"></i>Baixar Plug-In</a>
                </div>
            </div>
        </section>
        <section class="page-section" id="contact">
            <div class="container">
                <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">Contact Me</h2>
                <div class="divider-custom">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                </div>
                <div class="row">
                    <div class="col-lg-8 mx-auto">
                        <form id="contactForm" name="sentMessage" novalidate="novalidate">
                            <div class="control-group">
                                <div class="form-group floating-label-form-group controls mb-0 pb-2">
                                    <label>Name</label><input class="form-control" id="name" type="text" placeholder="Name" required="required" data-validation-required-message="Please enter your name." />
                                    <p class="help-block text-danger"></p>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="form-group floating-label-form-group controls mb-0 pb-2">
                                    <label>Email Address</label><input class="form-control" id="email" type="email" placeholder="Email Address" required="required" data-validation-required-message="Please enter your email address." />
                                    <p class="help-block text-danger"></p>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="form-group floating-label-form-group controls mb-0 pb-2">
                                    <label>Phone Number</label><input class="form-control" id="phone" type="tel" placeholder="Phone Number" required="required" data-validation-required-message="Please enter your phone number." />
                                    <p class="help-block text-danger"></p>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="form-group floating-label-form-group controls mb-0 pb-2">
                                    <label>Message</label><textarea class="form-control" id="message" rows="5" placeholder="Message" required="required" data-validation-required-message="Please enter a message."></textarea>
                                    <p class="help-block text-danger"></p>
                                </div>
                            </div>
                            <br />
                            <div id="success"></div>
                            <div class="form-group"><button class="btn btn-primary btn-xl" id="sendMessageButton" type="submit">Send</button></div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        <footer class="footer text-center">
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 mb-5 mb-lg-0">
                        <h4 class="text-uppercase mb-4">Location</h4>
                        <p class="lead mb-0">2215 John Daniel Drive<br />Clark, MO 65243</p>
                    </div>
                    <div class="col-lg-4 mb-5 mb-lg-0">
                        <h4 class="text-uppercase mb-4">Around the Web</h4>
                        <a class="btn btn-outline-light btn-social mx-1" href="#"><i class="fab fa-fw fa-facebook-f"></i></a><a class="btn btn-outline-light btn-social mx-1" href="#"><i class="fab fa-fw fa-twitter"></i></a><a class="btn btn-outline-light btn-social mx-1" href="#"><i class="fab fa-fw fa-linkedin-in"></i></a><a class="btn btn-outline-light btn-social mx-1" href="#"><i class="fab fa-fw fa-dribbble"></i></a>
                    </div>
                    <div class="col-lg-4">
                        <h4 class="text-uppercase mb-4">About Freelancer</h4>
                        <p class="lead mb-0">Freelance is a free to use, MIT licensed Bootstrap theme created by <a href="http://startbootstrap.com">Start Bootstrap</a>.</p>
                    </div>
                </div>
            </div>
        </footer>
      -->
        <section class="copyright py-4 text-center text-white">
            <div class="container"><small>PUC MINAS 2020</small></div>
        </section>
        <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes)-->
        <div class="scroll-to-top d-lg-none position-fixed">
            <a class="js-scroll-trigger d-block text-center text-white rounded" href="#page-top"><i class="fa fa-chevron-up"></i></a>
        </div>
        
        <!-- Bootstrap core JS-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
        <!-- Third party plugin JS-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
        <!-- Contact form JS-->
        <script src="assets/mail/jqBootstrapValidation.js"></script>
        <script src="assets/mail/contact_me.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>



        <script>
            //verificando se existe local storage
            if( localStorage.getItem("ListasDeSites") ){
                var sites = JSON.parse(localStorage.getItem("ListasDeSites"))
            }else{//se não existir cria local storage
                var sites = []
                localStorage.setItem("ListasDeSites", JSON.stringify(sites))
            }

           function pegandoURLParaVerificar(){
                var url = document.querySelector("#url").value//procura no site o valor da url

                //pegar apenas o domínio ex: divulggi.com.br
                url = url.replace("https://", "")
                url = url.replace("http://", "")
                url = url.replace("www.", "")
                if(url.indexOf('/') != -1){ //se tiver barra ele vai pegar a posição de onde tem a barra
                    url = url.substring(0, url.indexOf('/'))//vai fazer aparecer da posição 0 até a primeira barra
                }  



                var tanalista = false
                for(var i = 0; i < sites.length; i++){//percorre totas as listas jsons
                    if(url == sites[i].url){//verifica se ta na lista
                        tanalista = true
                        var pontuacaoFinal = sites[i].pontuacaoFinal//pega a pontuação
                        let resposta = [0,0,0]
                            sites[i].denuncias.forEach(element => {
                                if(element.tipo == "semreclamacao")
                                    resposta[0]++;
                                else if(element.tipo == "duvidoso")
                                    resposta[1]++;
                                else
                                    resposta[2]++; 
                            });
                        
                        if(pontuacaoFinal > 3){//verificação de pontuação para o aparecimento do modal
                            document.querySelector('#resposta1').innerHTML = ("Acreditamos que este site é CONFIÁVEL")      
                        }else if(pontuacaoFinal <= 3 && pontuacaoFinal >= -3){
                            document.querySelector('#resposta1').innerHTML = ("Acreditamos que este site é DUVIDOSO")
                        }else{
                            document.querySelector('#resposta1').innerHTML = ("Acreditamos que este site é MALICIOSO")
                        }
                        
                        document.querySelector('#resposta2').innerHTML = (`${resposta[0]} avaliações em SEM RECLAMAÇÕES`)               
                        document.querySelector('#resposta3').innerHTML = (`${resposta[1]} avaliações em DUVIDOSO`)               
                        document.querySelector('#resposta4').innerHTML = (`${resposta[2]} avaliações em MALICIOSO`) 

                        break
                    }
                }

                if(tanalista == false){//se não estiver na lista
                    console.log("esse site nunca foi nos alertado")
                    document.querySelector('#resposta').innerHTML = "Esse site nunca foi avaliado"
                }
            }

            
            function pegandoURLParInformar(informacao){//pegando como parâmetro status
                var url = document.querySelector("#urlInformacao").value
                var mensagem = mensagemInput.value;
                if(url == "" || mensagem == ""){
                   alertMensagem.innerHTML = "Preencha todos os campos!";
                $("#alertModal").modal("show");
                    return false;
                }
                url = url.replace("https://", "")
                url = url.replace("http://", "")
                url = url.replace("www.", "")
                if(url.indexOf('/') != -1){
                    url = url.substring(0, url.indexOf('/'))
                }  
                const avaliacao = {
                    "idUsuario": JSON.parse(localStorage.getItem("logado")).id,
                    "tipo": informacao,
                    "mensagem": mensagemInput.value,
                };
                var tanalista = false
                /*
                    localSorage chamado Avaliações[{url, denúncias[{tipo, pontuação, idLogado, mensagem}], pontuaçãoFinal }];
                */

                for(var i = 0; i < sites.length; i++){//um objeto já criado
                   if( url == sites[i].url ){//verifica se já existe
                        switch(informacao){
                            case "semreclamacao":
                                avaliacao.pontuacao = 1;
                                sites[i].denuncias.push(avaliacao);
                                sites[i].pontuacaoFinal++;
                                break;
                            case "duvidoso":
                                avaliacao.pontuacao = -1;
                                sites[i].denuncias.push(avaliacao);
                                sites[i].pontuacaoFinal--;
                                break;
                            case "acusar":
                                avaliacao.pontuacao = -2;
                                sites[i].denuncias.push(avaliacao);
                                sites[i].pontuacaoFinal -= 2;
                                break;
                        }
                        tanalista = true
                        console.log("ja está na lista")
                        break
                    }
                }

                if(tanalista == false){
                    sites.push( {"url": url, "pontuacaoFinal": 0, "denuncias":[]} ) 
                    switch(informacao){
                        case "semreclamacao":
                            avaliacao.pontuacao = 1;
                            sites[sites.length - 1].denuncias.push(avaliacao);
                            sites[sites.length - 1].pontuacaoFinal++;
                            break;
                        case "duvidoso":
                            avaliacao.pontuacao = -1;
                            sites[sites.length - 1].denuncias.push(avaliacao);
                            sites[sites.length - 1].pontuacaoFinal--;
                            break;
                        case "acusar":
                            avaliacao.pontuacao = -2;
                            sites[sites.length - 1].denuncias.push(avaliacao);
                            sites[sites.length - 1].pontuacaoFinal -= 2;
                            break;
                    }                   
                }

                
                

                localStorage.setItem("ListasDeSites", JSON.stringify(sites))//atualizando o local storage com novas informações
                console.log(sites)
                $("#mensagemModal").modal("hide");
                urlInformacao.value = "";
                mensagemInput.value = "";
                alertMensagem.innerHTML = "Sua avaliação foi registrada com sucesso!";
                $("#alertModal").modal("show");
            }

            /*
                localStorage.setItem("listasDeSites", sites) - cria a variavel local
                localStorage.getItem("listasDeSites") - retorna a variavel local

                document.querySelector("#url").value - pegando valor no html

                onClick="verificarSite()" - no html vc chama a funcao quando clica 
                
                function verificarSite() {
                    console.log("verificando")
                }
            */            
        </script>
    </body>
</html>
